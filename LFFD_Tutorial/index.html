<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="twitter:card" content="summary" /><title>LFFD Paper review | Giaco Stantino</title>
<meta name="description" content="Analyzing LFFD architecture, a one-stage object detection pipeline to detect faces">

<!-- SEO and meta information for twitter/whatsupp cards --><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>LFFD Paper review | Giaco Stantino</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="LFFD Paper review" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Analyzing LFFD architecture, a one-stage object detection pipeline to detect faces" />
<meta property="og:description" content="Analyzing LFFD architecture, a one-stage object detection pipeline to detect faces" />
<link rel="canonical" href="https://giastantino.github.io/repository/LFFD_Tutorial/" />
<meta property="og:url" content="https://giastantino.github.io/repository/LFFD_Tutorial/" />
<meta property="og:site_name" content="Giaco Stantino" />
<meta property="og:image" content="https://images.unsplash.com/photo-1499781350541-7783f6c6a0c8?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjYzOTIxfQ" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-07-23T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Analyzing LFFD architecture, a one-stage object detection pipeline to detect faces","headline":"LFFD Paper review","@type":"BlogPosting","dateModified":"2021-07-23T00:00:00-05:00","datePublished":"2021-07-23T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://giastantino.github.io/repository/LFFD_Tutorial/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://giastantino.github.io/repository/images/logo.png"}},"url":"https://giastantino.github.io/repository/LFFD_Tutorial/","image":"https://images.unsplash.com/photo-1499781350541-7783f6c6a0c8?ixlib=rb-1.2.1&q=85&fm=jpg&crop=entropy&cs=srgb&ixid=eyJhcHBfaWQiOjYzOTIxfQ","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<!-- Feed --><link type="application/atom+xml" rel="alternate" href="https://giastantino.github.io/repository/feed.xml" title="Giaco Stantino" /><!-- CSS --><link rel="shortcut icon" type="image/x-icon" href="/repository/images/favicon.ico"><link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="https://giastantino.github.io/repository/assets/css/main.css" />
<noscript><link rel="stylesheet" href="https://giastantino.github.io/repository/assets/css/noscript.css" /></noscript>
<link rel="stylesheet" href="https://giastantino.github.io/repository/assets/stylesheets/main.css" />
<link rel="stylesheet" href="https://giastantino.github.io/repository/assets/css/academicons.min.css"/>

<!-- Analytics --><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Q8QVC01BMZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-Q8QVC01BMZ');
</script>

<!-- google search -->
<meta name="google-site-verification" content="eo4A8Z3U5MisXvF1etpKMZu-ipYw7wVckqVlSnnFzMw" />

<!-- Math -->


  </head>
  <body class="is-loading">

    <!-- Wrapper -->
      <div id="wrapper" class="fade-in">

        <!-- Header -->
        <header id="header">
          <a href="https://giastantino.github.io/repository/" class="logo">Giaco Stantino</a>
        </header>

        <!-- Nav -->
          <nav id="nav">

            <ul class="links">
  <li class=""><a href="https://giastantino.github.io/repository/">Home</a></li>
  <li class=""><a href="https://giastantino.github.io/repository/blog/">Tech</a></li>
  <!-- <li class=""><a href="https://giastantino.github.io/repository/tags/">Tags</a></li> -->
  <li class=""><a href="https://giastantino.github.io/repository/arts/">Arts</a></li>
  <li class=""><a href="https://giastantino.github.io/repository/poetry/">Poetry</a></li>
  <li class=""><a href="https://giastantino.github.io/repository/resume/">Resume</a></li>
  <li class=""><a href="https://giastantino.github.io/repository/categories/">Categories</a></li>
  <li class=""><a href="https://giastantino.github.io/repository/about/">About Me</a></li>

</ul>

<ul class="icons">
  <li class=""><a href="https://giastantino.github.io/repository/search" class="icon fa-search"><span class="label">Search</span></a></li>
  <li><a href="https://github.com/giastantino" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
  <!-- <li><a href="https://twitter.com/Twitter" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a></li> -->
<!--   <li>
    
      <a href="/repository/feed.xml" title="Atom Feed" class="icon fa-rss">
        <span class="label">Subscribe</span>
      </a>
    
  </li> -->
</ul>


          </nav>

        <!-- Main -->
        <div id="main">

          <!-- Post -->
          <section class="post">
            
            <p><article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">LFFD Paper review</h1><p class="page-description">Analyzing LFFD architecture, a one-stage object detection pipeline to detect faces</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-07-23T00:00:00-05:00" itemprop="datePublished">
        Jul 23, 2021
      </time>• 



<span class="read-time" title="Estimated read time">

  4 min read

</span>

    </p>

    
      <p class="category-tags"><i class="fa fa-folder category-tags-icon"></i></i>
      
        <a class="category-tags-link" href="/repository/categories/#deep_learning">deep_learning</a>
        &nbsp;
      
        <a class="category-tags-link" href="/repository/categories/#resnet">resnet</a>
        
      
      </p>
    

    

    
      
        <div class="nb-badges" style="display: flex; justify-content: flex-end">
          
          
          <div class="px-2">
    <a href="https://colab.research.google.com/github/giastantino/repository/blob/master/_notebooks/2021-07-23-LFFD_Tutorial.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/repository/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Introduction:">Introduction: </a></li>
<li class="toc-entry toc-h1"><a href="#Contents:">Contents: </a></li>
<li class="toc-entry toc-h1"><a href="#Receptive-Field-(RF)-vs-Effective">Receptive Field (RF) vs Effective </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Receptive-field-(RF)">Receptive field (RF) </a></li>
<li class="toc-entry toc-h3"><a href="#Effective-Receptive-field-(ERF)">Effective Receptive field (ERF) </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Large-faces-vs-tiny-faces">Large faces vs tiny faces </a></li>
<li class="toc-entry toc-h1"><a href="#RFs-as-Natural-"Anchor"">RFs as Natural &quot;Anchor&quot; </a></li>
<li class="toc-entry toc-h1"><a href="#Network-Architecture">Network Architecture </a></li>
<li class="toc-entry toc-h1"><a href="#Sources:">Sources: </a></li>
<li class="toc-entry toc-h1"><a href="#Code-(under-construction):">Code (under construction): </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Implementation:">Implementation: </a></li>
<li class="toc-entry toc-h2"><a href="#--negative_positive-ratio-:-During-the-computation,-by-default-most-of-the-bboxes-would-belong-to-class-'background'.-In-order-to-avoid-this-imbalance,-we-keep-a-limit-on-the-num-of-background-bboxes-that-would-be-a-part-of-the-loss-function-(Try-a-value-b/w-3-and-10)">- negative_positive ratio : During the computation, by default most of the bboxes would belong to class &#39;background&#39;. In order to avoid this imbalance, we keep a limit on the num of background bboxes that would be a part of the loss function (Try a value b/w 3 and 10) </a></li>
</ul>
</li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-07-23-LFFD_Tutorial.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="https://images.unsplash.com/photo-1499781350541-7783f6c6a0c8?ixlib=rb-1.2.1&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb&amp;ixid=eyJhcHBfaWQiOjYzOTIxfQ" alt="https://images.unsplash.com/photo-1499781350541-7783f6c6a0c8?ixlib=rb-1.2.1&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb&amp;ixid=eyJhcHBfaWQiOjYzOTIxfQ"></p>
<h1 id="Introduction:">
<a class="anchor" href="#Introduction:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction:<a class="anchor-link" href="#Introduction:"> </a>
</h1>
<hr>
<p>LFFD is an anchor free face detector and belongs to the one-stage category of object detection mechanisms</p>
<p>Receptive Fields (RFs) are deployed as natural “anchors”</p>
<h1 id="Contents:">
<a class="anchor" href="#Contents:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contents:<a class="anchor-link" href="#Contents:"> </a>
</h1>
<hr>
<ul>
<li>Receptive Field (RF) vs Effective Receptive Field (ERF)</li>
<li>Large faces vs tiny faces</li>
<li>RFs as Natural "Anchor"</li>
<li>Network Architecture<blockquote>
<p>Unlike in fully connected networks, where the value of each unit depends on the entire input to the network, a unit in convolutional networks only depends on a region of the input.
This region in the input is the <strong>receptive field</strong> for that unit.</p>
</blockquote>
</li>
</ul>
<p>Source:Understanding the Effective Receptive Field in Deep Convolutional Neural Networks
✏️✏️✏️</p>
<h1 id="Receptive-Field-(RF)-vs-Effective">
<a class="anchor" href="#Receptive-Field-(RF)-vs-Effective" aria-hidden="true"><span class="octicon octicon-link"></span></a>Receptive Field (RF) vs Effective<a class="anchor-link" href="#Receptive-Field-(RF)-vs-Effective"> </a>
</h1>
<p>Receptive Field (ERF):</p>
<hr>
<p><img src="https://i1.wp.com/syncedreview.com/wp-content/uploads/2017/05/24.png?resize=950%2C485&amp;ssl=1" alt="https://i1.wp.com/syncedreview.com/wp-content/uploads/2017/05/24.png?resize=950%2C485&amp;ssl=1"></p>
<p><a href="https://i1.wp.com/syncedreview.com/wp-content/uploads/2017/05/24.png?resize=950%2C485&amp;ssl=1">Image Source</a></p>
<h3 id="Receptive-field-(RF)">
<a class="anchor" href="#Receptive-field-(RF)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Receptive field (RF)<a class="anchor-link" href="#Receptive-field-(RF)"> </a>
</h3>
<hr>
<p>Consider the scenario above: (visualisation on lower left) 💡💡💡</p>
<ol>
<li>Input image (blue 💙) with padding 1 (refer visualisation on upper left)</li>
<li>1st convolutional filter with kernel size 3x3 and stride 2 (shaded portion on input image - refer the green 💚 lines projected from feature map to input image)</li>
<li>2nd convolutional filter with kernel size 3x3 and stride 2 (shaded portion on input image - refer the orange 🧡 lines projected from feature map to input image)yellow</li>
<li>First feature map (green 💚) with output size 3x3 <strong><em>as a result of convolving first cnn filter with input image</em></strong>
</li>
<li>Second feature map (orange 🧡)  with output size 2x2 <strong><em>as a result of convolving second cnn filter with first feature map</em></strong>
</li>
<li>The size of feature maps reduce consecutively due to stride 2 🚧🚧🚧🚧<blockquote>
<p>If you notice, the receptive field (<strong>RF</strong>) of the first neuron belonging to the first convolutional filter (green 💚) is <em>**</em> a 3x3 patch of the input image(blue 💙). The output feature map consists of 9 neurons/features (<em>each neuron will have a RF of 3x3</em>)</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>Similarly,  the receptive field (<strong>RF</strong>) of the first neuron belonging to the second convolutional filter (orange 🧡)  is <em>**</em> a 7x7 patch of the input image(blue 💙). The output feature map consists of 4 neurons/features (<em>each neuron will have a RF of 7x7</em>)</p>
<p><strong>With this intuition we can state that the neurons in shallow layers have small RFs and those
in deeper layers have large RFs.</strong></p>
</blockquote>
<p>📔 For mathematical equations you could refer to following <a href="https://syncedreview.com/2017/05/11/a-guide-to-receptive-field-arithmetic-for-convolutional-neural-networks/">link</a></p>
<h3 id="Effective-Receptive-field-(ERF)">
<a class="anchor" href="#Effective-Receptive-field-(ERF)" aria-hidden="true"><span class="octicon octicon-link"></span></a>Effective Receptive field (ERF)<a class="anchor-link" href="#Effective-Receptive-field-(ERF)"> </a>
</h3>
<hr>
<p>However, one thing that the authors (Luo, Wenjie et al) of the paper <em>"Understanding the Effective Receptive Field in Deep Convolutional Neural Networks"</em> notice is that not all pixels in the receptive field contribute equally to the output unit’s response</p>
<p>The pixels that actually contribute to learning is what we call the <em>Effective</em> <em>Receptive Field (ERF)</em></p>
<p>If you notice this is clearly visible by the pixels that are repeatedly covered by the kernel as it is convolved with the input image. The edge pixels are convolved lesser number of times as compared to the centre pixels. (You could try this out in your head and it will make more sense )</p>
<p>Thus the ERF plays an important role when it comes to learning.</p>
<!-- ![https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1cad073b-06ab-4de9-8b5a-ed24d7cb7249/Untitled.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/1cad073b-06ab-4de9-8b5a-ed24d7cb7249/Untitled.png) -->

<p><img src="https://media.springernature.com/lw685/springer-static/image/art%3A10.1007%2Fs11042-020-09143-7/MediaObjects/11042_2020_9143_Fig1_HTML.png" alt="Image Source"></p>
<p>✏️✏️✏️</p>
<h1 id="Large-faces-vs-tiny-faces">
<a class="anchor" href="#Large-faces-vs-tiny-faces" aria-hidden="true"><span class="octicon octicon-link"></span></a>Large faces vs tiny faces<a class="anchor-link" href="#Large-faces-vs-tiny-faces"> </a>
</h1>
<hr>
<p>The paper treats large and tiny faces differently.</p>
<p>The assumption is that tiny faces are more difficult to recognize as compared to larger faces.</p>
<p>In order to capture tiny faces more contextual information is used to come to a conclusion</p>
<blockquote>
<p>As the paper states:- for tiny/small faces, ERFs have to cover the faces aswell as sufficient context information</p>
<ul>
<li>for medium faces, ERFs only have to contain the faces
with little context information</li>
<li>for large faces, only keeping them in RFs is enough</li>
</ul>
</blockquote>
<p>✏️✏️✏️</p>
<h1 id='RFs-as-Natural-"Anchor"'>
<a class="anchor" href="#RFs-as-Natural-" anchor aria-hidden="true"><span class="octicon octicon-link"></span></a>RFs as Natural "Anchor"<a class="anchor-link" href="#RFs-as-Natural-%22Anchor%22"> </a>
</h1>
<hr>
<p>Face detection falls under the category of object detection and the authors try to avoid the use of anchor boxes as in general object detection pipelines and use the receptive fields as natural anchors.</p>
<p>Since faces have an aspect ratio of 1:1 kernels with width and height as 1 is used to generate square shaped RFs to detect faces. For the matching strategy, the RF box is matched to a ground truth (GT) box iff its center falls in the GT bbox, other than thresholding IOU</p>
<p>✏️✏️✏️</p>
<h1 id="Network-Architecture">
<a class="anchor" href="#Network-Architecture" aria-hidden="true"><span class="octicon octicon-link"></span></a>Network Architecture<a class="anchor-link" href="#Network-Architecture"> </a>
</h1>
<hr>
<p><img src="https://img.techpowerup.org/200917/screenshot-from-2020-09-17-11-11-00.png" alt="https://img.techpowerup.org/200917/screenshot-from-2020-09-17-11-11-00.png"></p>
<p>The network architecture is divided into 4 parts.</p>
<ul>
<li>tiny part - has 10 convolution layers</li>
<li>small part</li>
<li>medium part</li>
<li>large part</li>
</ul>
<p>The first two layers downsample the input with stride 4, stride 2 from each</p>
<h1 id="Sources:">
<a class="anchor" href="#Sources:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sources:<a class="anchor-link" href="#Sources:"> </a>
</h1>
<hr>
<ul>
<li><a href="https://www.youtube.com/watch?v=rj9j_FTI25o">https://www.youtube.com/watch?v=rj9j_FTI25o</a></li>
<li><a href="https://syncedreview.com/2017/05/11/a-guide-to-receptive-field-arithmetic-for-convolutional-neural-networks/">https://syncedreview.com/2017/05/11/a-guide-to-receptive-field-arithmetic-for-convolutional-neural-networks/</a></li>
<li><a href="https://arxiv.org/abs/1603.07285">https://arxiv.org/abs/1603.07285</a></li>
</ul>
<h1 id="Code-(under-construction):">
<a class="anchor" href="#Code-(under-construction):" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code (under construction):<a class="anchor-link" href="#Code-(under-construction):"> </a>
</h1>
<hr>
<ul>
<li>[ ]  Data Augmentation</li>
<li>[ ]  LFFD backbone CNN</li>
<li>[ ]  Priors and matching strategy</li>
<li>[ ]  LFFD Loss</li>
</ul>
<h2 id="Implementation:">
<a class="anchor" href="#Implementation:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation:<a class="anchor-link" href="#Implementation:"> </a>
</h2>
<hr>
<p>The LFFD Loss function is similar to an SSD Multibox Loss function.</p>
<p>It consists of :</p>
<h2 id="--negative_positive-ratio-:-During-the-computation,-by-default-most-of-the-bboxes-would-belong-to-class-'background'.-In-order-to-avoid-this-imbalance,-we-keep-a-limit-on-the-num-of-background-bboxes-that-would-be-a-part-of-the-loss-function-(Try-a-value-b/w-3-and-10)">
<a class="anchor" href="#--negative_positive-ratio-:-During-the-computation,-by-default-most-of-the-bboxes-would-belong-to-class-'background'.-In-order-to-avoid-this-imbalance,-we-keep-a-limit-on-the-num-of-background-bboxes-that-would-be-a-part-of-the-loss-function-(Try-a-value-b/w-3-and-10)" aria-hidden="true"><span class="octicon octicon-link"></span></a>- negative_positive ratio : During the computation, by default most of the bboxes would belong to class 'background'. In order to avoid this imbalance, we keep a limit on the num of background bboxes that would be a part of the loss function (Try a value b/w 3 and 10)<a class="anchor-link" href="#--negative_positive-ratio-:-During-the-computation,-by-default-most-of-the-bboxes-would-belong-to-class-'background'.-In-order-to-avoid-this-imbalance,-we-keep-a-limit-on-the-num-of-background-bboxes-that-would-be-a-part-of-the-loss-function-(Try-a-value-b/w-3-and-10)"> </a>
</h2>
<p>-</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="giastantino/repository"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/repository/LFFD_Tutorial/" hidden></a>
</article>

</p>
          </section>

          <!-- Footer -->
            <footer>
              <ul class="actions">
                <li><a href="https://giastantino.github.io/repository/" class="button">Home</a></li>
                <li><a href="https://giastantino.github.io/repository/blog/" class="button">Blog</a></li>
              </ul>
            </footer>
          </div>

        <!-- Footer -->
        <!-- Copyright -->
<!-- <style>
  li {
     text-shadow: 0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px white;
  }
</style> -->

<div id="copyright">
  <ul>
    <li style = "text-shadow: 0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px white;">&copy; Deep Wilson   
      <a href="https://github.com/giastantino" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a>  
      <!-- <a href="https://twitter.com/Twitter" class="icon fa-twitter" rel="nofollow"><span class="label">Twitter</span></a> -->
<!--       <a href="https://orcid.org/" class="ai ai-orcid" rel="nofollow"><span class="label">ORCID</span></a> | -->
<!--       <a href="https://scholar.google.es/citations?user=" class="ai ai-google-scholar" rel="nofollow"><span class="label">Google Scholar</span></a> | -->
<!--       
      <a href="/repository/feed.xml" title="Atom Feed" class="icon fa-rss" rel="nofollow">
        <span class="label">Subscribe</span>
      </a>
       -->
    </li> 
    <li style = "text-shadow: 0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px white;">Powered by <a href="https://github.com/Outsiders17711/Mein.Platz/">Oluwaleke Umar Yusuf</a>  &
      <a href="https://fastpages.fast.ai/">fastpages</a> &
      <a href="https://github.com/OriolAbril">Oriol Abril Pla</a></li>
    <li style = "text-shadow: 0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px white;">Design by <a href="https://html5up.net" rel="nofollow">HTML5 UP</a> &
      <a href="https://github.com/mmistakes/jekyll-theme-basically-basic">Basically Basic</a> &
      <a href="https://jekyllup.com/">JekyllUp</a> </li>
    <!-- <li><a href="https://github.com/Outsiders17711/Mein.Platz">Mein.Platz</a> /
      <a href="https://github.com/Outsiders17711/Mein.Platz/actions">@actions</a> </li> -->
  </ul>
</div>


      </div>

    <!-- Scripts -->
    <!-- DYN -->
<script src="https://giastantino.github.io/repository/assets/js/jquery.min.js"></script>
<script src="https://giastantino.github.io/repository/assets/js/jquery.scrollex.min.js"></script>
<script src="https://giastantino.github.io/repository/assets/js/jquery.scrolly.min.js"></script>
<script src="https://giastantino.github.io/repository/assets/js/skel.min.js"></script>
<script src="https://giastantino.github.io/repository/assets/js/util.js"></script>
<script src="https://giastantino.github.io/repository/assets/js/main.js"></script>


  </body>
</html>
